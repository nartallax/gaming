# Omnipresence

Инструмент для упрощения управления большим количеством окон Lineage II.

Умеет:
1. Открывать окна, логинить в них персонажей, перелогинивать выпавших
2. Собирать из персонажей party
3. Рассылать нажатия клавиш персонажам в окнах на заднем плане
4. "Активировать" окна на заднем плане для предотвращения отставания персонажей
5. ... и еще немного (о некоторых дополнительных возможностях см. ниже).

Как использовать:

1. Раздобыть NodeJS.
В данный момент его можно скачать в https://nodejs.org/dist/.
Omnipresence писался и тестировался под версией 6.10.0; возможно, будет работать под более поздними/ранними версиями.
Для проверки, что этот шаг пройден успешно, откройте консоль и напишите node --version. Эта команда должна вывести "v6.10.0" (номер версии, которую вы установили).

2. Раздобыть javascript-common.
Он должен быть здесь https://github.com/nartallax/javascript-common
Нужно скачать его и положить так, чтобы libs/meta/adddict.js был доступен по относительному пути, указанному в самом начале main.js (в строчке require(...))

3. Конфигурировать.
Конфигурация лежит в 3 файлах. Все они - рядом с main.js - config.js, charconfig.js и passwords.json. Последний не поставляется вместе с тулом; вам нужно будет его создать.

config.js содержит, в основном, значения задержек, которые нужно соблюдать при работе с интерфейсом. Вам может потребоваться редактировать их, если у вас слабый компьютер; но, если omnipresence работает хорошо, не надо их трогать.

charconfig.js содержит информацию о персонажах и копиях клиента. В файле есть примеры.

Описание клиента содержит следующие поля:
binary - информация о пути до .exe-файла клиента.
simpleGraph - флаг "упрощенной графики". Используйте, если на клиенте установлен специальный user.ini, который позволяет использовать кнопку Home для упрощенного графического режима.
isDefault - флаг; если true, то клиент будет использован в случае, если не указан.
affinity - к какому ядру процессора будет привязан этот клиент. Почему-то обычно все клиенты привязываются к одному ядру процессора, что создает тормоза. Возможные значения - число (конкретный номер ядра), массив чисел (будет выбрано наименее загруженное среди указанных), или строка (имя одной из стратегий выбора ядра, описанных в файле app/core.selection.strategy.js).

Описание персонажа содержит следующие поля:
login - логин аккаунта, на котором существует персонаж. Omnipresence не умеет выбирать из нескольких персонажей на одном аккаунте; поэтому, если на этом же аккаунте есть другой персонаж и предыдущий раз при игре с этого аккаунта был выбран он, то возникнет путаница. Избегайте создавать нескольких персонажей на одном аккаунте.
password - пароль от аккаунта. Возможно, вы захотите хранить его в passwords.json; об этом ниже. Но его также можно указать и строкой прямо в описании.
name - имя персонажа
roles - роли персонажа; массив строк, описывающих, какие возможности имеет персонаж.
profession - профессия персонажа.

passwords.json содержит пароли. Они вынесены в отдельный файл, чтобы их было удобнее контролировать. 
Пример содержимого этого файла: {"first_password":"123321", "second_password": "qwerty"}

4. Задать сценарий.

Сценарий определяет, каких персонажей следует использовать и как.
Для примера сценария посмотрите в scenario/p1.js. Там показаны основные приемы работы с персонажами - логин, перезаход выпавших, сбор party, навешивание горячих клавиш на главное окно (для управления прочими окнами из него).
Создайте свой файл сценария в той же папке.

5. Запускать

Запуск производится из консоли, командой вида node main.js --scenario p1 . Параметр scenario позволяет выбрать имя используемого сценария.

# Дополнительные возможности

Command-line интерфейс

Существует возможность задать интерфейс командной строки. Для этого необходимо использовать пакет op.cli (см. пример в сценарии p1).


Распределенное многооконное управление

Также существует возможность вынести часть окон на другой компьютер (возможно, даже на несколько!).
Для этого нужно:
1. В charconfig.js, в разделе hosts, определить все компьютеры, участвующие в системе, и их роли.
Каждый компьютер может быть либо master, либо slave. slave-компьютеры принимают команду с master-компьютеров. Для определения компьютера достаточно указать его ip-адрес и hostname. hostname не должны повторяться для разных компьютеров, т.к. с их помощью происходит определение, на каком именно компьютере запустился конкретный экземпляр программы.
Главное отличие master и slave - за master-компьютером (который может быть только один) сидит живой человек; за slave-компьютером нет никого. На клиенты на slave-ах нельзя навешивать горячие клавиши.
2. Определить хотя бы по одному клиенту для каждого компьютера.
По умолчанию, все клиенты считаются запускаемыми на том компьютере, на котором возникла команда их запускать; однако это можно переопределить, указав свойство host в определении клиента. В значении этого свойства должно быть имя ранее определенного хоста (не путать с hostname! здесь ожидается то имя, которое вы задали хосту выше в конфиге).
При определении клиента путь к клиенту указывается на том компьютере, на котором он в действительности запустится.
3. Скопировать конфигурацию, omnipresence и клиенты на все компьютеры.
Подразумевается, что у всех компьютеров одна и та же конфигурация. Могут различаться конфигурации задержек, однако charconfig ожидается одинаковый.
4. Запустить omnipresence на всех участвующих компьютерах; сначала на slave, потом (последним) - на master.
При запуске omnipresence самостоятельно определит, master он или slave. При запуске в качестве slave сценарий указывать не следует, т.к. он будет проигнорирован.